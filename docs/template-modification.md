<p align="center">
    <img width="605" src="https://img.shields.io/badge/submodule-docs-inactive?style=for-the-badge&labelColor=BAC99C&color=779966&logo=data:image/png;base64,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">
</p>

# Template Modification

This is a general guide on how the template modification scripts packaged with submodule work in order to create a nested tree-like nav in the auto-generated docs in place of the existing flat nav that jsdoc produces given that jsdoc has no vanilla support for nested modules. Please see below and consult the relevant source code to understand how to implement a script to support your own 3rd party template. 

### Table of Contents

- [Scripts](#scripts)
  - [Shared Scripts](#shared-scripts)
  - [Template Scripts](#template-scripts)

- [Styles](#styles)
  - [Shared Styles](#shared-styles)
  - [Template Styles](#template-styles)

- [Injection](#injection)
  - [Bundle Configuration](#bundle-configuration)
  - [Shared Injection Configuration](#shared-injection-configuration)
  - [Template Injection Configuration](#template-injection-configuration)

- [Rendering](#rendering)
  - [Hierarchy](#hierarchy)
  - [Method Priority](#method-priority)
  - [Access and Scope](#access-and-scope)
  - [Icons](#icons)

## Scripts

Template modification scripts are bundled from an entry point at `src/web/scripts/<template-name>/index.js`, and imported shared scripts which provide methods for rendering from a data object generated by the template specific scripts. For the shared scripts, see `src/web/scripts/shared` or browse [shared scripts](https://github.com/blameitonyourisp/submodule/tree/master/src/web/scripts/shared) on github. For template specific scripts, please see `src/web/scripts/<template-name>/index.js` or browse the [scripts directory](https://github.com/blameitonyourisp/submodule/tree/master/src/web/scripts) on github for entry points for each specific 3rd party template.

### Shared Scripts

As above, shared scripts may be found at `src/web/scripts/shared`, or may be viewed [here](https://github.com/blameitonyourisp/submodule/tree/master/src/web/scripts/shared). Shared scripts are responsible for:

- Exporting shared regular expressions used for identifying the type, hierarchy, scope etc. of a given module fragment
- Rendering the module tree that is generated by the template specific scripts to the container elements provided by the template specific scripts

### Template Scripts

As above, template specific scripts may be found at `src/web/scripts/<template-name>`, the standard entry point for a given template modification script being `src/web/scripts/<template-name>/index.js`. Template specific scripts are responsible for:

- Mounting existing elements on the page (whose markup may be different between templates), and providing containers to which the new nav and nested title may be rendered
- Parsing existing elements into a nested tree of modules
- Importing shared scripts for rendering using the parsed module tree

To implement a set of template scripts for your own 3rd party jsdoc template, please see existing template modification scripts and duplicate them according to the markup generated by your template. For example see the [docdash](https://github.com/clenemt/docdash) template scripts which may be found at `src/web/scripts/docdash` or browse the directory [here](https://github.com/blameitonyourisp/submodule/tree/master/src/web/scripts/docdash).

For templates (such as the default template) which do not list the methods in the nav underneath the module link for the currently active/open module, the template scripts can either omit the methods from the module tree used for rendering (obviously method names will then not be displayed in the nav), or may use elements in the body of the page pertaining to the module methods (method titles, method signatures etc.) to generate the array of child methods required for rendering.

## Styles

Each submodule template modification script points to two css stylesheets. One shared stylesheet, `style.ccs`, and one template specific stylesheet `<template-name>.css`. All styles may be found at `src/web/styles`. To view the shared stylesheet, please see `src/web/styles/style.css` or view the [shared stylesheet](https://github.com/blameitonyourisp/submodule/blob/master/src/web/styles/style.css) on github. To find template specific stylesheets, please see `src/web/styles/<template-name>.css` or browse the [styles directory](https://github.com/blameitonyourisp/submodule/tree/master/src/web/styles) on github.

### Shared Styles

As above, shared styles may be found at `src/web/styles/style.css`, or may be viewed [here](https://github.com/blameitonyourisp/submodule/blob/master/src/web/styles/style.css). Shared styles are responsible only for styling the content rendered by the shared scripts, limiting effects of rules to the bounds of the containers provided by the template scripts. By using submodule specific classes and selectors, shared scripts should not affect the style of elements anywhere else on the original page.

### Template Styles

As above, template styles may be found at `src/web/styles/<template-name>.css`. Template styles are responsible for resolving mismatches in spacing and any other undesirable style issues observed between the injected markup and the original page. Template styles are template specific, and should only contain rules that will not need to be applied across all jsdoc templates.

## Injection

Each template modification script must be bundled from its entry point at `src/web/scripts/<template-name>/index.js` and then injected in some way into the html generated by jsdoc in conjunction with any template which may be used.

### Bundle Configuration

Submodule template modification scripts are bundled using [rollup](https://rollupjs.org/), the rollup configuration for the build script may be found at `config/rollup.config.js` or [viewed here](https://github.com/blameitonyourisp/submodule/blob/master/config/rollup.config.js). Please see the following snippet for the rollup configuration object relating to bundling a specific template modification script (in this case [docdash](https://github.com/clenemt/docdash)). Note that ([as explained above](#template-scripts)), the source file for the target bundled script may be found at `src/web/scripts/<template-name>/index.js`. Styles are injected using the [postcss plugin](https://github.com/egoist/rollup-plugin-postcss) for rollup, and are usually included into the bundle at the top level of the listed `index.js` file. 

```
{
    input: "src/web/scripts/docdash/index.js",
    output: [
        { file: "dist/docdash.min.js", format: "iife", sourcemap: true }
    ],
    plugins: [
        terser({ maxWorkers: 6 }),
        postcss({ plugins: [] })
    ]
}
```

### Shared Injection Configuration

To include the bundled script in the output directory of the generated jsdoc documentation, you must point jsdoc to the file(s) you wish to include. This is a vanilla jsdoc feature, and will be a shared step regardless of which template you are using. To include static files in the output directory, please consult jsdoc documentation on [configuring the default template](https://jsdoc.app/about-configuring-default-template.html), or see the following jsdoc config snippet. All static files listed will appear in the top level of the output directory specified elsewhere in the config file. It is not required to inculde sourcemaps unless you wish to inspect or debug the code.

```json
{
    "templates": {
        "default": {
            "staticFiles": {
                "include": [
                    "node_modules/@13ms/submodule/dist/<template-name>.min.js",
                    "node_modules/@13ms/submodule/dist/<template-name>docdash.min.js.map"
                ]
            }
        }
    }
}
```

### Template Injection Configuration

Obviously to include the bundled script in the output documentation, a tag similar to `<script src="<template-name>.min.js"></script>` must be included in each of the output html files. Some templates support this feature out of the box (for example see the following snippet of a jsdoc config using the [docdash](https://github.com/clenemt/docdash) template). Other jsdoc templates may not support this feature, in which case a custom npm script must be written to include the required script in each page (at this time submodule does not provide such a script).

```json
{
    "docdash": {
        "scripts": [ "docdash.min.js" ]
    }
}
```

## Rendering

Submodule template modification scripts will render a nested tree-like nav in place of the existing flat module nav. Modules with longer paths will be indented further in the nav reflective of most file explorers in IDEs etc. Unlike a regular file explorers, clicking on a file (or module with methods as members) will cause the methods to also be rendered in the nav. 

Note that since submodule renders its nav with only information available on the current page, submodule does no display expanded siblings at the current nav level or expanded parents relative to the current nav level (i.e. you can only have one module folder open at any given time, and any methods which are direct children of a parent module will not be displayed if you are currently viewing a child module page). This is because to render this data would require a `commonNav` feature (as is offered by templates such as [docdash](https://github.com/clenemt/docdash)), which for templates not supporting this feature out of the box, would require the injected submodule script to load each page in the generated module nav in order to construct a parsed module tree that would be identical regardless of which page was loaded. Obviously for larger projects this would soon get out of hand, so submodule can only render its nav based on data which is available to it in the current page (i.e. data rendered by the given template), although also this drawback has the benefit of stopping the module nav components becoming overly long.

### Hierarchy

Please see the following table for rendering notes on available hierarchies for modules in the module nav tree. Note that specific colours etc. may change depending on included stylesheets or the jsdoc template used, and the following is a guide mostly on physical positioning of elements in the tree. As explained above the name of each hierarchy should more or less be sufficient to indicate the indentation position in the tree since submodule renders the module tree similarly to most file explorers.

| Hierarchy  | Render Notes                                                 |
| ---------- | ------------------------------------------------------------ |
| `selected` | Currently selected module - will be rendered with "traditional" link formatting i.e. altered text colour and underline text decoration |
| `parent`   | Parents of selected module - will be indented to the left of the selected module and will be greyed out (parents further up will be indented further to the left, the root/top-level modules being left aligned to the side of the nav component) |
| `child`    | Direct children of selected module - will be indented one level to the right of the current selected module |
| `sibling`  | Siblings of slected module - will be indented at the same level as the current selected module |
| `hidden`   | Grandchildren, or modules not on the path of the selected module - will be hidden/not rendered in the module nav (`display: none`) |

### Method Priority

Methods and or members of a module will be ordered by submodule in the rendered nested module nav in the following order/priority (obviously if two fragments are equal on a given discriminator move to the next to determine priority):

1. Fragment type - module fragments with child modules (i.e. rendered as folders) will always be listed above module fragments with only methods etc. as children (i.e. rendered as files)
2. Method scope - methods will be ordered according to the scope signature `global` > `instance` > `static` > `inner`
3. Method Access - methods will be ordered according to the access signature `public` > `package` > `protected` > `private`
4. Alphabetically - methods will be ordered in ascending alphabetical order

### Access and Scope

Access values of generated jsdoc method signature will be rendered in small text in a pseudo element after the link text of the method. Since ([as indicated above](#method-priority)) methods of the same scope will be grouped together in the rendered nav tree, submodule will add markup for a scope title for each group of methods with a different scope signature. This choice allows the rendered nav tree to quickly display both the scope and access of any given method to the reader.

### Icons

Please find below the table of assets used for rendering the module nav tree, including links to 3rd party source and the fragment types for which icon is used. The "selected" type column refers to any fragment that is currently active (i.e. has the hierarchy `selected` and is the module that is currently in the url). The "deselected" type column refers to a fragment with any different hierarchy (i.e. it is inactive, and not the current opened module). As above, `hidden` fragments will not be rendered at all. Note that fragments of type `method` do not have an assigned icon.

| Name               | Source                                                       | Type Selected                | Type Deselected    | Icon                                                         |
| ------------------ | ------------------------------------------------------------ | ---------------------------- | ------------------ | ------------------------------------------------------------ |
| `folder-open`      | [open folder asset link](https://www.svgrepo.com/svg/450896/folder-open) | `module`, `namespace-module` | n/a                | <img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='64px' height='64px' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M21 5h-8.8L11 3H4L2.8 5H1v16h20l2.902-12H21zM2 6h1.366l1.2-2h5.868l1.2 2H20v3h-5.6l-2 2H4.35L2 18.015zm20.632 4l-2.42 10H2.39l2.68-8h7.744l2-2z'/%3E%3Cpath fill='none' d='M0 0h24v24H0z'/%3E%3C/svg%3E" alt="folder-open" /> |
| `folder-closed`    | [closed folder asset link](https://www.svgrepo.com/svg/450891/folder) | n/a                          | `module`           | <img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='64px' height='64px' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2.8 5H1v16h22V5H12.2L11 3H4zM22 20H2V9h20zM10.434 4l1.2 2H22v2H2V6h1.366l1.2-2z'/%3E%3Cpath fill='none' d='M0 0h24v24H0z'/%3E%3C/svg%3E" alt="folder-closed" /> |
| `folder-namespace` | [namespace folder asset link](https://www.svgrepo.com/svg/450894/folder-move) | n/a                          | `namespace-module` | <img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='64px' height='64px' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 19V8h20v7.466l1 1.01V4H12.2L11 2H4L2.8 4H1v16h9v-1zM2 5h1.366l1.2-2h5.868l1.2 2H22v2H2zm21.182 14.5l-3.828 3.853-.709-.706 2.647-2.665H12v-1h9.257l-2.611-2.63.709-.704z'/%3E%3Cpath fill='none' d='M0 0h24v24H0z'/%3E%3C/svg%3E" alt="folder-namespace" /> |
| `file`             | [file asset link](https://www.svgrepo.com/svg/450862/file-code) | `file`                       | `file`             | <img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --%3E%3Csvg width='64px' height='64px' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 23h18V6.709L15.29 1H3zM15 2h.2L20 6.8V7h-5zM4 2h10v6h6v14H4zm9.13 9.044l.938.35-3.199 8.583-.937-.35zm2.224 1.603l2.853 2.853-2.854 2.854-.707-.707 2.147-2.147-2.146-2.146zm-6 .707L7.207 15.5l2.146 2.146-.707.707L5.793 15.5l2.854-2.854z'/%3E%3Cpath fill='none' d='M0 0h24v24H0z'/%3E%3C/svg%3E" alt="file-code" /> |
